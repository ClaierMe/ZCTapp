function getCookie(t){var n,i=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(n=document.cookie.match(i))?unescape(n[2]):null}function delCookie(t){var n=new Date;n.setTime(n.getTime()-31536e7);var i=getCookie(t);null!=i&&(document.cookie=t+"="+i+";expires="+n.toGMTString()+";path=/")}var nextStopData="";function selectData(){if(""!=nextStopData&&nextStopData){var t=$("#stopCheck").val();if($(".next_record_div").html(""),""==t){var n="",a=nextStopData.length;for(i=0;i<a;i++)n+="<div class='next_record' id='"+nextStopData[i].id+"'>",n+="<div class='next_record_first'>",n+="    <img src='../img/stopLocation.png' alt=''>",n+="    <span>"+nextStopData[i].name+"</span>",n+="</div>",n+="<div class='next_record_second'><span>"+nextStopData[i].meters+"m</span></div>",n+="</div>";$(".next_record_div").html(n),$(".next_record").click(function(){var t=$(this).attr("id");location.href="/views/actual_list.html?stopId="+t})}else{n="",a=nextStopData.length;for(i=0;i<a;i++)nextStopData[i].name.indexOf(t)>-1&&(n+="<div class='next_record' id='"+nextStopData[i].id+"'>",n+="<div class='next_record_first'>",n+="    <img src='../img/stopLocation.png' alt=''>",n+="    <span>"+nextStopData[i].name+"</span>",n+="</div>",n+="<div class='next_record_second'><span>"+nextStopData[i].meters+"m</span></div>",n+="</div>");$(".next_record_div").html(n),$(".next_record").click(function(){var t=$(this).attr("id");location.href="/views/actual_list.html?stopId="+t})}}}function changePos(t,n){var i={},a=3e3*Math.PI/180,e=n,o=t,c=Math.sqrt(e*e+o*o)+2e-5*Math.sin(o*a),s=Math.atan2(o,e)+3e-6*Math.cos(e*a),l=c*Math.cos(s)+.0065,r=c*Math.sin(s)+.006;return i.lng=l,i.lat=r,i}$(function(){$("#line").val(""),$("#stopCheck").val(""),$("#check_line").click(function(){var t=$("#line").val();t.length<1?window.yl.call("showToast",{content:"请输入正确的线路号",duration:3e3}):location.href="/views/actual_list.html?line="+t}),$(".line_search").click(function(){$(".content1").css("display","inline"),$(".content2").css("display","none"),$(".line_search").html("<img src='../img/line2choice@3x.png' alt=''><span>线路搜索</span>"),$(".line_next").html("<img src='../img/next_gray.png' alt=''><span class='bottom_gray'>附近站点</span>"),nextStopData=""}),$(".line_next").click(function(){$(".content1").css("display","none"),$(".content2").css("display","inline"),$(".line_search").html("<img src='../img/line2@3x.png' alt=''><span class='bottom_gray'>线路搜索</span>"),$(".line_next").html("<img src='../img/next_light.png' alt=''><span >附近站点</span>"),$(".next_record_div").html(""),window.yl.call("showLoading",{content:"正在加载中…",duration:15e3}),window.yl.call("getLocation",{},{onSuccess:function(t){window.yl.call("hideLoading");var n=changePos(t.param.latitude,t.param.longitude);$.post(CONFIG.getLineInfoAndCardInfo+"/realtimebus/query/queryService/nearStation",{p0:n.lng,p1:n.lat,p2:300},function(t){var n,i=JSON.parse(t).stations;if(nextStopData=i,i){var a="",e=i.length;if(e>0){for(n=0;n<e;n++)a+="<div class='next_record' id='"+i[n].id+"'>",a+="<div class='next_record_first'>",a+="    <img src='../img/stopLocation.png' alt=''>",a+="    <span>"+i[n].name+"</span>",a+="</div>",a+="<div class='next_record_second'><span>"+i[n].meters+"m</span></div>",a+="</div>";$(".next_record_div").html(a),$(".next_record").click(function(){var t=$(this).attr("id");location.href="/views/actual_list.html?stopId="+t})}else nextStopData="",a+="<div class='noRecord'>",a+="    <img src='../img/noRecord.png' alt=''>",a+="    <p>附近没有找到相关站点</p>",a+="</div>",$(".next_record_div").html(a)}})},onFail:function(t){window.yl.call("hideLoading"),window.yl.call("showToast",{content:"请确保APP获得定位权限后重试",duration:3e3})}})}),$("#clear_history").click(function(){zct.confirmAlert({title:"历史记录",content:"是否清除历史记录"},function(t){localStorage.carStop=JSON.stringify({}),$(".history_div").html("")},function(t){})});var t="",n=localStorage.carStop;if(n)for(var i in n=JSON.parse(n))t+="<div class='line_record' id='"+n[i]+"'>",t+="        <img src='../img/history@3x.png' alt=''>",t+="        <span>"+decodeURI(n[i])+"</span>",t+="    </div>";$(".history_div").html(t),$(".history_div div").click(function(){var t=$(this).attr("id");location.href=encodeURI("/views/actual_car.html?routeName="+t)})});